--- 
title: Some Ruby & Rails Tricks
date: 27/08/2008

I certainly can't claim to have <em>discovered</em> these tips; but they've been pretty helpful to me. Maybe this will just make them a little easier to find for whoever is looking for them next.

<h3>Getting A Collection's Index From Within a Partial</h3>

Lets say you're passing a collection to a partial, but that somewhere in that partial you are interested in knowing which index you're at. Do you need to implement a counter? Nope; there already is one. A collection passed to a partial implicitly creates a counter called <code>[partial_name]_counter</code>. So, if you called with

<pre lang="ruby">
< %= render :partial => 'thing', :collection => @a_few_of_my_favorite_things %>
</pre>

then in your partial, you could use:

<pre lang="ruby">
< %= thing_counter %>
</pre>

to return the index as you plow through the collection. Life is good. Rails is looking out for you. (Hat tip to <a href="http://gmarik.blogspot.com/2007/09/rails-collection-index-within-partial.html">GMarik</a>, which is where I saw this one.)

<h3>Obtaining a Class name From a String</h3>

Today I found myself wanting to take a string, let's say <code>"Thing"</code>, and use it as a class name, <code>Thing</code>. Again, it turns out this can be done. In Ruby, class names are constants, so you can do 

<pre lang="ruby">
str = "Thing" #=> "Thing"
Kernel.const_get(str) #=> Thing
</pre>

Hooray!

<h3>Make Finding Easier</h3>

Find yourself writing long, complicated find expressions in your code? There is a better way.

Perhaps in your code... maybe even in a view... maybe you want to find all <code>Things</code> that don't belong to the current use, and which are flagged with some property, and you're temped to write something like:

<pre lang="ruby">
Thing.find(:all, :conditions => ["user != ? and flag = true", current_user])
</pre>

What we could do is put some <code>has_finder</code>s in the Thing model, something like

<pre lang="ruby">
class Thing < ActiveRecord::Base
has_finder :exclude_user, lambda {|user| {:conditions => "things.user_id != #{user.id}"}
has_finder :with_flag, :conditions => "things.flag = true"
</pre>

Having done that, you could now replace that first bit with:

<pre lang="ruby">
Thing.find(:all).with_flag.exclude_user(current_user)
</pre>

It's a little shorter, sure, but more importantly, when you read it, it just makes more sense. A completely new person coming to look at this line would have a good idea what it was doing without even looking in the model to see what the <code>has_finder</code>s were doing.

<h3>Okay then</h3>

If you've spent any amount of time using rails, these probably aren't new to you. Everything's new at least <em>once</em>, though, so hopefully these are helpful to someone.

Other favorite ruby or rails tricks? Leave a comment! Heck, we're not prejudiced, here, go ahead and comment with your favorite Python or Perl or [other language] tricks, too, if you like.